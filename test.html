<!DOCTYPE html>
<html>
  <head> 
    <meta charset="UTF-8"> 
    <title>GTA X</title> 
  </head> 
  <body> 
    <canvas id="myCanvas" width="1300" height="350"> 
      <!-- Вставьте fallback содержимое здесь -->
      К сожалению, ваш браузер не поддерживает технологию canvas
    </canvas> 
    <script>
  const canvas = document.getElementById('myCanvas');
  let ctx = canvas.getContext('2d');
  let width = canvas.width, height = canvas.height;
  let player = {
    speed: 5,
    gravity: 10,
    x: 0,
    y: 0, //250
    width: 64,
    height: 64,
    sx: 0, // 64
    sy: 710,
    sw: 64,
    sh: 64,
    skin: 'img/skin.png',
    tick_count: 0
  };
  let keys = {}; // Объект с нжатыми клавишами
  let player_skin = new Image();
  player_skin.src = player.skin;
  player_skin.onload = function() {
    gameLoop();
    requestAnimationFrame(gameLoop);
  }

  function gameLoop() {
    if (player.tick_count >= 9) {
      if (keys[68]) {
        player.sy = 710;
        player.x += player.speed;
        if (player.sx === 512) {
          player.sx = 0;
        } 
        player.sx += player.sw;
        console.log(player.y);
      } 

      if (keys[65]) {
        player.sy = 580;
        player.x -= player.speed;
        if (player.sx === 512) {
          player.sx = 0;
        }
        player.sx += player.sw;
        console.log(player.y);
      }

      if (keys[83]) {
        player.sy = 1285;
        if (player.sx == 320) { // 320 т.к всего 6 (отсчет с 0) кадров (Формула: 5 * 64 = 320 )
          player.sx -= 64; // 320 - 64 = 256
        } 
        player.sx += player.sw;
      }

      if(keys[87]) {
        player.y -= (player.gravity + 5);
        console.log(player.y);
      }
      drawImage();
      player.tick_count = 0;
    }
    player.tick_count++;
    requestAnimationFrame(gameLoop);
  }

  function drawImage() {
    addEventListener('keydown', move_player, false);
    addEventListener('keyup', stop_player, false);
    if (player.y < 250) {
      player.y += (player.gravity / 2);
    }
    ctx.clearRect(0, 0, width, height);
    ctx.drawImage(player_skin, player.sx, player.sy, player.sw, player.sh, player.x, player.y, player.width, player.height);
  }

  function reset() {
    player.sx = 0;
    player.tick_count = 0;
  }

  function move_player(e) {
    if (e.keyCode == 68) { //Ходьба в право
      keys[e.keyCode] = true;
    } else if (e.keyCode == 65) { //Ходьба в лево
      keys[e.keyCode] = true;
    } else if (e.keyCode == 83) { // Вниз 
      keys[e.keyCode] = true;
    } else if (e.keyCode == 87) { // Прыжок
      keys[e.keyCode] = true;
    }
    console.log(e.keyCode);
  }

  function stop_player(e) {
    if (e.keyCode == 68) { //Ходьба в право
      keys[e.keyCode] = false;
      reset();
    } else if (e.keyCode == 65) { //Ходьба в лево
      keys[e.keyCode] = false;
      reset();
    } else if (e.keyCode == 83) { // Вниз 
      keys[e.keyCode] = false;
      reset();
    } else if (e.keyCode == 87) { // Прыжок
      keys[e.keyCode] = false;
    }
  }
  
</script>
  </body> 
</html>
